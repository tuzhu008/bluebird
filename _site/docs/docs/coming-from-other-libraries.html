<p>This page is a reference for migrating to bluebird from other flow control or promise libraries. See <a href="install.html">installation</a> on how to use bluebird in your environment.</p>

<ul>
  <li><a href="#coming-from-native-promises">Coming from native promises</a></li>
  <li><a href="#coming-from-jquery-deferreds">Coming from jQuery deferreds</a></li>
  <li><a href="#coming-from-async-module">Coming from <code class="highlighter-rouge">async</code> module</a></li>
  <li><a href="#coming-from-q">Coming from Q</a></li>
  <li><a href="#coming-from-co">Coming from co/koa</a></li>
  <li><a href="#coming-from-highland">Coming from highland, RxJS or BaconJS</a></li>
</ul>

<p>##Coming from native promises</p>

<p>Bluebird promises are a drop-in replacement for native promises except for subclassing. Additionally you might want to replace usages of the often incorrectly used <a href=".">Promise.race</a> with bluebird’s <a href=".">Promise.any</a> which does what is usually mistakenly expected from <a href=".">Promise.race</a>. For maximum compatibility, bluebird does provide <a href=".">Promise.race</a> with ES6 semantics.</p>

<p>You can also refactor some looping patterns to a more natural form that would <a href="https://github.com/promises-aplus/promises-spec/issues/179">leak memory when using native promises</a>.</p>

<p>##Coming from jQuery deferreds</p>

<p>Bluebird treats jQuery deferreds and promises interchangeably. Wherever you can take a promise or return a promise, you can take or return a jQuery deferred instead and it works the same.</p>

<p>For instance, there is no need to write something like this:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">firstRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({...}).</span><span class="nx">done</span><span class="p">(</span><span class="nx">resolve</span><span class="p">).</span><span class="nx">fail</span><span class="p">(</span><span class="nx">reject</span><span class="p">);</span>
<span class="p">});</span>
<span class="kd">var</span> <span class="nx">secondRequest</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({...}).</span><span class="nx">done</span><span class="p">(</span><span class="nx">resolve</span><span class="p">).</span><span class="nx">fail</span><span class="p">(</span><span class="nx">reject</span><span class="p">);</span>
<span class="p">});</span>

<span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span><span class="nx">firstRequest</span><span class="p">,</span> <span class="nx">secondRequest</span><span class="p">]).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Since <a href=".">Promise.all</a> takes promises, it must also take jQuery deferreds, so the above can be shortened to:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">firstRequest</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({...});</span>
<span class="kd">var</span> <span class="nx">secondRequest</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({...});</span>

<span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span><span class="nx">firstRequest</span><span class="p">,</span> <span class="nx">secondRequest</span><span class="p">]).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">});</span>
</code></pre></div></div>

<p>That said, if you have code written using jQuery deferred methods, such as <code class="highlighter-rouge">.then</code>, <code class="highlighter-rouge">.done</code> and so on, you cannot drop-in replace the jQuery deferred with a bluebird promise in that code. Despite having the same names, jQuery deferred methods have different semantics than bluebird promise methods. These differences are due to the completely different goals of the implementations. Bluebird is <a href="http://en.wikipedia.org/wiki/Domain-specific_language">an internal DSL</a> for the domain of asynchronous control flow while jQuery deferreds are a callback aggregator utility (“glorified event emitters”).</p>

<p>If you do have some code using jQuery deferred methods extensively try to see if some of these jQuery deferred patterns and their replacements can be applied:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// jQuery</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">when</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">someArray</span><span class="p">).</span><span class="nx">then</span><span class="p">(...)</span>
<span class="c1">// bluebird</span>
<span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">someArray</span><span class="p">).</span><span class="nx">then</span><span class="p">(...)</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// jQuery</span>
<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">processItemsDeferred</span> <span class="o">=</span> <span class="p">[];</span>

<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">processItemsDeferred</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">processItem</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]));</span>
<span class="p">}</span>

<span class="nx">$</span><span class="p">.</span><span class="nx">when</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">processItemsDeferred</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">everythingDone</span><span class="p">);</span>

<span class="c1">// bluebird</span>
<span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">];</span>
<span class="nb">Promise</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">processItem</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">everythingDone</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// jQuery</span>
<span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>
<span class="nx">d</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s2">"value"</span><span class="p">);</span>
<span class="c1">// bluebird</span>
<span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s2">"value"</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// jQuery</span>
<span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>
<span class="nx">d</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">"error"</span><span class="p">));</span>
<span class="c1">// bluebird</span>
<span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">reject</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">"error"</span><span class="p">));</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// jQuery</span>
<span class="kd">var</span> <span class="nx">clicked</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>
<span class="nx">$</span><span class="p">(</span><span class="s2">"body"</span><span class="p">).</span><span class="nx">one</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">clicked</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
<span class="p">});</span>
<span class="c1">// bluebird</span>
<span class="kd">var</span> <span class="nx">clicked</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">"body"</span><span class="p">).</span><span class="nx">one</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="nx">resolve</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// jQuery</span>
<span class="p">.</span><span class="nx">always</span><span class="p">(</span><span class="nx">removeSpinner</span><span class="p">);</span>
<span class="c1">// bluebird</span>
<span class="p">.</span><span class="k">finally</span><span class="p">(</span><span class="nx">removeSpinner</span><span class="p">);</span>
</code></pre></div></div>

<p>##Coming from <code class="highlighter-rouge">async</code> module</p>

<p>When working with promises the philosophy is basically a complete opposite than when using <code class="highlighter-rouge">async</code>. Async provides a huge bag of uncomposable helper functions that work at a very low level of abstraction. When using promises you can get the utility otherwise provided by uncountable amount of inflexible helper functions by just combining and composing a few existing functions and concepts.</p>

<p>That means when you have a problem there probably isn’t an existing function tailored exactly to that problem but instead you can just combine the existing utilities to arrive at a solution. The upside of this is that you don’t need to come up with all these different functions to solve problems that are not that different from each other. The most important thing to do when migrating from async to bluebird is this profound shift in philosophy.</p>

<p>This section lists the most common async module replacements.</p>

<p>###<code class="highlighter-rouge">async.waterfall</code></p>

<p>If the waterfall elements are static, you can just replace it with a normal promise chain. For waterfalls with dynamic steps, use <a href=".">Promise.each</a>. Multiple arguments can be ferried in an array.</p>

<p>Implementing the example from <a href="https://github.com/caolan/async#waterfalltasks-callback">async homepage</a></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span><span class="p">.</span><span class="nx">waterfall</span><span class="p">([</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="s1">'one'</span><span class="p">,</span> <span class="s1">'two'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// arg1 now equals 'one' and arg2 now equals 'two'</span>
        <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="s1">'three'</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// arg1 now equals 'three'</span>
        <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="s1">'done'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result now equals 'done'</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Since the array passed to waterfall is static (always the same 3 functions) a plain old promise chain is used:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">([</span><span class="s1">'one'</span><span class="p">,</span> <span class="s1">'two'</span><span class="p">]).</span><span class="nx">spread</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// arg1 now equals 'one' and arg2 now equals 'two'</span>
    <span class="k">return</span> <span class="s1">'three'</span><span class="p">;</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">arg1</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// arg1 now equals 'three'</span>
    <span class="k">return</span> <span class="s1">'done'</span><span class="p">;</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result now equals 'done'</span>
<span class="p">});</span>
</code></pre></div></div>

<p>If destructuring parameters are supported, <code class="highlighter-rouge">.spread(function(arg1, arg2) {})</code> can be replaced with <code class="highlighter-rouge">.then(function([arg1, arg2]){})</code>.</p>

<p>###<code class="highlighter-rouge">async.series</code></p>

<p>Using <a href=".">Promise.mapSeries</a> to implement the example from <a href="https://github.com/caolan/async#seriestasks-callback">async homepage</a>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span><span class="p">.</span><span class="nx">series</span><span class="p">([</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">){</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">},</span> <span class="mi">200</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">){</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
        <span class="p">},</span> <span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">],</span>
<span class="c1">// optional callback</span>
<span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">){</span>
    <span class="c1">// results is now equal to [1, 2]</span>
<span class="p">});</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">Promise</span><span class="p">.</span><span class="nx">mapSeries</span><span class="p">([{</span><span class="na">timeout</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                   <span class="p">{</span><span class="na">timeout</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="mi">2</span><span class="p">}],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">delay</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">timeout</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// results is now equal to [1, 2]</span>
<span class="p">});</span>
</code></pre></div></div>

<p>###<code class="highlighter-rouge">async.parallel</code></p>

<p>Using <a href=".">Promise.all</a> to implement the example from <a href="https://github.com/caolan/async#parallel">async homepage</a>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span><span class="p">.</span><span class="nx">parallel</span><span class="p">([</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">){</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="s1">'one'</span><span class="p">);</span>
        <span class="p">},</span> <span class="mi">200</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">){</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="s1">'two'</span><span class="p">);</span>
        <span class="p">},</span> <span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">],</span>
<span class="c1">// optional callback</span>
<span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">){</span>
    <span class="c1">// the results array will equal ['one','two'] even though</span>
    <span class="c1">// the second function had a shorter timeout.</span>
<span class="p">});</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">([</span><span class="nb">Promise</span><span class="p">.</span><span class="nx">delay</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s1">'one'</span><span class="p">),</span>
             <span class="nb">Promise</span><span class="p">.</span><span class="nx">delay</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="s1">'two'</span><span class="p">)]).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// the results array will equal ['one','two'] even though</span>
    <span class="c1">// the second function had a shorter timeout.</span>
<span class="p">});</span>
</code></pre></div></div>

<p>###<code class="highlighter-rouge">async.mapSeries</code></p>

<p>Using <a href=".">Promise.each</a> to implement the example from <a href="https://github.com/caolan/async#maparr-iterator-callback">async homepage</a>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>
<span class="k">async</span><span class="p">.</span><span class="nx">mapSeries</span><span class="p">([</span><span class="s1">'file1'</span><span class="p">,</span><span class="s1">'file2'</span><span class="p">,</span><span class="s1">'file3'</span><span class="p">],</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">){</span>
    <span class="c1">// results is now an array of stats for each file</span>
<span class="p">});</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">promisifyAll</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">));</span>
<span class="nb">Promise</span><span class="p">.</span><span class="nx">each</span><span class="p">([</span><span class="s1">'file1'</span><span class="p">,</span><span class="s1">'file2'</span><span class="p">,</span><span class="s1">'file3'</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fileName</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">statAsync</span><span class="p">(</span><span class="nx">fileName</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// results is now an array of stats for each file</span>
<span class="p">});</span>
</code></pre></div></div>

<p>###<code class="highlighter-rouge">async.map</code></p>

<p>Using <a href=".">Promise.map</a> to implement the example from <a href="https://github.com/caolan/async#maparr-iterator-callback">async homepage</a>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">);</span>
<span class="k">async</span><span class="p">.</span><span class="nx">map</span><span class="p">([</span><span class="s1">'file1'</span><span class="p">,</span><span class="s1">'file2'</span><span class="p">,</span><span class="s1">'file3'</span><span class="p">],</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">){</span>
    <span class="c1">// results is now an array of stats for each file</span>
<span class="p">});</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">promisifyAll</span><span class="p">(</span><span class="nx">require</span><span class="p">(</span><span class="s1">'fs'</span><span class="p">));</span>
<span class="nb">Promise</span><span class="p">.</span><span class="nx">map</span><span class="p">([</span><span class="s1">'file1'</span><span class="p">,</span><span class="s1">'file2'</span><span class="p">,</span><span class="s1">'file3'</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fileName</span><span class="p">,</span> <span class="nx">index</span><span class="p">,</span> <span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">statAsync</span><span class="p">(</span><span class="nx">fileName</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// results is now an array of stats for each file</span>
<span class="p">});</span>
</code></pre></div></div>

<p>###<code class="highlighter-rouge">async.whilst</code></p>

<p>Using recursion to implement the example from <a href="https://github.com/caolan/async#whilsttest-fn-callback">async homepage</a>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">async</span><span class="p">.</span><span class="nx">whilst</span><span class="p">(</span>
    <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">count</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="p">},</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
        <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
    <span class="p">},</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 5 seconds have passed</span>
    <span class="p">}</span>
<span class="p">);</span>
</code></pre></div></div>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="kd">function</span> <span class="nx">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">count</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">delay</span><span class="p">(</span><span class="mi">1000</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">loop</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
<span class="p">})().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// 5 seconds have passed</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Be warned that the above example implementations are only superficially equivalent. Callbacks, even with the help of async, require too much boilerplate code to provide the same guarantees as promises.</p>

<p>##Coming from Q</p>

<p>Q and bluebird share a lot of common methods that nevertheless have different names:</p>

<ul>
  <li><code class="highlighter-rouge">Q(...)</code> -&gt; <a href=".">Promise.resolve()</a></li>
  <li><code class="highlighter-rouge">.fail()</code> -&gt; <a href=".">.catch()</a> or <code class="highlighter-rouge">.caught()</code></li>
  <li><code class="highlighter-rouge">.fin()</code> -&gt; <a href=".">.finally()</a> or <code class="highlighter-rouge">.lastly()</code></li>
  <li><code class="highlighter-rouge">Q.fcall()</code> -&gt; <a href=".">Promise.try</a> or <code class="highlighter-rouge">Promise.attempt()</code></li>
  <li><code class="highlighter-rouge">.thenResolve()</code> -&gt; <a href=".">.return()</a> or <code class="highlighter-rouge">.thenReturn()</code></li>
  <li><code class="highlighter-rouge">.thenReject()</code> -&gt; <a href=".">.throw()</a> or <code class="highlighter-rouge">thenThrow()</code></li>
</ul>

<p>##Coming from co/koa</p>

<p>In recent versions generator libraries started abandoning old ideas of special tokens passed to callbacks and started using promises for what’s being yielded.</p>

<p>Bluebird’s <a href=".">Promise.coroutine</a> is a superset of the <code class="highlighter-rouge">co</code> library, being more extensible as well as supporting cancellation (in environments where <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator/return"><code class="highlighter-rouge">Generator#return</code></a> is implemented).</p>

<p>##Coming from highland, RxJS or BaconJS</p>

<p>Stream libraries tend to serve a different purpose than promise libraries. Unlike promise libraries streams can represent multiple values.</p>

<p>Check out the benchmarks section for examples of transitioning an API from Bacon/Rx to promises.</p>
